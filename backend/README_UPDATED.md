# WiseStar-MathAgent åç«¯APIæœåŠ¡ - å®Œæ•´ç‰ˆ

## ğŸ‰ æœ€æ–°æ›´æ–°

### æ–°å¢åŠŸèƒ½æ¨¡å—

1. **å­¦ä¹ è®°å¿†å­˜å‚¨ç³»ç»Ÿ** (`memory_storage.py`)
   - å®Œæ•´çš„å­¦ä¹ è®°å½•å­˜å‚¨å’ŒæŸ¥è¯¢
   - è‡ªåŠ¨åˆå§‹åŒ–20æ¡ç¤ºä¾‹æ•°æ®
   - æ”¯æŒæŒ‰æ ‡ç­¾å’Œéš¾åº¦ç­›é€‰
   - è‡ªåŠ¨ç»Ÿè®¡è–„å¼±çŸ¥è¯†ç‚¹å’Œå·²æŒæ¡çŸ¥è¯†ç‚¹

2. **ç»Ÿè®¡æ•°æ®è®¡ç®—æ¨¡å—** (`statistics_calculator.py`)
   - æ¯å‘¨æ´»åŠ¨è¶‹åŠ¿ç»Ÿè®¡
   - çŸ¥è¯†ç‚¹åˆ†å¸ƒåˆ†æ
   - éš¾åº¦åˆ†å¸ƒç»Ÿè®¡
   - æˆåŠŸç‡è¶‹åŠ¿è®¡ç®—

3. **æ¯æ—¥ä¸€é¢˜æ¨èç³»ç»Ÿ** (`daily_recommender.py`)
   - æ™ºèƒ½æ¨èç®—æ³•ï¼ˆæ”¯æŒ3ç§ç­–ç•¥ï¼‰
   - 7é“é«˜è´¨é‡é¢˜ç›®æ± 
   - åŸºäºè–„å¼±çŸ¥è¯†ç‚¹çš„ä¸ªæ€§åŒ–æ¨è
   - å®Œæ•´çš„å†å²è®°å½•å’Œç»Ÿè®¡

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å…¥ä½ çš„API Keyï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```
LLM_API_KEY=your_deepseek_api_key
LLM_BASE_URL=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat
```

### 3. å¯åŠ¨æœåŠ¡

```bash
python app.py
```

æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨

### 4. æŸ¥çœ‹APIæ–‡æ¡£

è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£

## APIç«¯ç‚¹è¯¦è§£

### 1. POST /solve - æ™ºèƒ½è§£é¢˜

**è¯·æ±‚ä½“**:
```json
{
  "question": "é¢˜ç›®å†…å®¹"
}
```

**å“åº”**:
```json
{
  "success": true,
  "answer": "æœ€ç»ˆç­”æ¡ˆ",
  "steps": [
    {"type": "reasoning", "content": "æ¨ç†å†…å®¹"},
    {"type": "calculation", "content": "è®¡ç®—è¯´æ˜", "code": "Pythonä»£ç "}
  ],
  "statistics": {
    "total_steps": 8,
    "reasoning_steps": 5,
    "calculation_steps": 3,
    "time_used": "45ç§’"
  }
}
```

**æ–°åŠŸèƒ½**: è§£é¢˜æˆåŠŸåè‡ªåŠ¨ä¿å­˜åˆ°å­¦ä¹ è®°å¿†

---

### 2. POST /generate - ç”Ÿæˆé¢˜ç›®

**è¯·æ±‚ä½“**:
```json
{
  "difficulty_level": "ä¸­ç­‰",
  "problem_type": "å‡½æ•°",
  "topic_keywords": ["å¯¼æ•°", "ä¸ç­‰å¼"],
  "requirements": "éœ€è¦å‚æ•°è®¨è®º"
}
```

**å“åº”**:
```json
{
  "success": true,
  "problem": "é¢˜ç›®æ–‡æœ¬",
  "latex": "LaTeXæºç ",
  "evaluation": {
    "overall_score": 8.5,
    "originality_score": 9.0,
    "solvability_score": 8.0,
    "complexity_score": 8.5,
    "knowledge_coverage_score": 9.0,
    "educational_value_score": 8.5
  },
  "validation": {
    "success": true,
    "answer": "æ ‡å‡†ç­”æ¡ˆ"
  },
  "iterations": 1
}
```

---

### 3. GET /statistics - ç»Ÿè®¡æ•°æ® âœ¨ æ–°å¢çœŸå®æ•°æ®

**å“åº”**:
```json
{
  "weekly_data": [
    {"day": "å‘¨ä¸€", "solved": 3, "generated": 2},
    ...
  ],
  "knowledge_data": [
    {"name": "å‡½æ•°", "value": 15, "color": "#3b82f6"},
    ...
  ],
  "difficulty_data": [
    {"name": "ç®€å•", "value": 20, "color": "#10b981"},
    ...
  ],
  "progress_data": [
    {"month": "1æœˆ", "rate": 65},
    ...
  ],
  "success_rate": 0.76,
  "weekly_count": 34,
  "mastered_topics": 12,
  "streak_days": 15
}
```

**æ•°æ®æ¥æº**: åŸºäºå­¦ä¹ è®°å¿†è‡ªåŠ¨è®¡ç®—

---

### 4. GET /memory - å­¦ä¹ è®°å½• âœ¨ æ–°å¢çœŸå®æ•°æ®

**æŸ¥è¯¢å‚æ•°**:
- `tag` (å¯é€‰): æŒ‰æ ‡ç­¾ç­›é€‰ï¼Œå¦‚ "å‡½æ•°"ã€"å¯¼æ•°"
- `difficulty` (å¯é€‰): æŒ‰éš¾åº¦ç­›é€‰ï¼Œå¦‚ "ç®€å•"ã€"ä¸­ç­‰"ã€"å›°éš¾"

**å“åº”**:
```json
{
  "total": 20,
  "success_rate": 0.85,
  "weak_points": ["ç«‹ä½“å‡ ä½•", "å¤æ•°"],
  "mastered_points": ["å‡½æ•°", "å¯¼æ•°", "ä¸‰è§’å‡½æ•°"],
  "records": [
    {
      "id": 1,
      "question": "æ±‚å‡½æ•° f(x) = xÂ³ - 3x + 1 åœ¨åŒºé—´ [-2, 2] ä¸Šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼",
      "answer": "æœ€å¤§å€¼ä¸º 3ï¼Œæœ€å°å€¼ä¸º -1",
      "tags": ["å‡½æ•°", "å¯¼æ•°"],
      "difficulty": "ä¸­ç­‰",
      "success": true,
      "steps": 8,
      "timestamp": "2025-01-20 14:30:25",
      "time_used": "45ç§’"
    },
    ...
  ]
}
```

**åˆå§‹æ•°æ®**: åŒ…å«20æ¡ç¤ºä¾‹å­¦ä¹ è®°å½•

---

### 5. GET /daily - æ¯æ—¥ä¸€é¢˜ âœ¨ æ–°å¢æ™ºèƒ½æ¨è

**æŸ¥è¯¢å‚æ•°**:
- `strategy` (å¯é€‰): æ¨èç­–ç•¥
  - `balanced` (é»˜è®¤): å¹³è¡¡æ¨¡å¼ï¼Œ70%è–„å¼±çŸ¥è¯†ç‚¹ï¼Œ30%å¤ä¹ 
  - `weak`: ä¸“æ³¨è–„å¼±çŸ¥è¯†ç‚¹
  - `random`: éšæœºæ¨è

**å“åº”**:
```json
{
  "date": "2025-01-20",
  "question": "å·²çŸ¥å‡½æ•° f(x) = ln(x) - ax...",
  "tags": ["å‡½æ•°", "å¯¼æ•°", "ä¸ç­‰å¼"],
  "difficulty": "å›°éš¾",
  "source": "ç³»ç»Ÿæ¨è",
  "strategy": "balanced",
  "answer": "å®Œæ•´ç­”æ¡ˆ",
  "hint": "è§£é¢˜æç¤º",
  "streak": 3,
  "total_completed": 20,
  "success_rate": 0.75,
  "history": [
    {"date": "2025-01-19", "completed": true, "success": true},
    ...
  ]
}
```

**é¢˜ç›®æ± **: åŒ…å«7é“é«˜è´¨é‡é¢˜ç›®ï¼Œæ¶µç›–å¤šä¸ªçŸ¥è¯†ç‚¹

---

### 6. POST /daily/submit - æäº¤ç­”æ¡ˆ

**è¯·æ±‚ä½“**:
```json
{
  "questionId": 1,
  "answer": "ç­”æ¡ˆå†…å®¹"
}
```

**å“åº”**:
```json
{
  "success": true,
  "correct": true,
  "feedback": "ç­”æ¡ˆæ­£ç¡®"
}
```

---

### 7. POST /plot/execute - æ‰§è¡ŒPythonä»£ç 

**è¯·æ±‚ä½“**:
```json
{
  "code": "import matplotlib.pyplot as plt..."
}
```

**å“åº”**:
```json
{
  "success": true,
  "image": "data:image/png;base64,..."
}
```

---

### 8. POST /plot/generate - AIç”Ÿæˆç»˜å›¾ä»£ç 

**è¯·æ±‚ä½“**:
```json
{
  "description": "ç»˜åˆ¶ä¸€ä¸ªåœ†å’Œä¸€æ¡ç›´çº¿"
}
```

**å“åº”**:
```json
{
  "success": true,
  "code": "å®Œæ•´çš„Pythonä»£ç ",
  "explanation": "ä»£ç è¯´æ˜"
}
```

---

## æ•°æ®å­˜å‚¨

### å­¦ä¹ è®°å¿†æ•°æ®

**å­˜å‚¨ä½ç½®**: `backend/data/memory_records.json`

**æ•°æ®ç»“æ„**:
```json
{
  "records": [
    {
      "id": 1,
      "question": "é¢˜ç›®å†…å®¹",
      "answer": "ç­”æ¡ˆ",
      "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
      "difficulty": "éš¾åº¦",
      "success": true,
      "steps": 8,
      "timestamp": "2025-01-20 14:30:25",
      "time_used": "45ç§’"
    }
  ]
}
```

**åˆå§‹åŒ–**: é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º20æ¡ç¤ºä¾‹æ•°æ®

**è‡ªåŠ¨æ›´æ–°**: æ¯æ¬¡è§£é¢˜æˆåŠŸåè‡ªåŠ¨æ·»åŠ è®°å½•

---

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app.py                      # FastAPIä¸»åº”ç”¨ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ config.py                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ llm_client.py              # LLMè°ƒç”¨å®¢æˆ·ç«¯
â”œâ”€â”€ python_executor.py         # Pythonä»£ç æ‰§è¡Œå™¨
â”œâ”€â”€ prompts.py                 # Promptæ¨¡æ¿
â”œâ”€â”€ memory_storage.py          # âœ¨ å­¦ä¹ è®°å¿†å­˜å‚¨æ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ statistics_calculator.py   # âœ¨ ç»Ÿè®¡æ•°æ®è®¡ç®—æ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ daily_recommender.py       # âœ¨ æ¯æ—¥ä¸€é¢˜æ¨èæ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ data/                     # âœ¨ æ•°æ®å­˜å‚¨ç›®å½•ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ memory_records.json   # å­¦ä¹ è®°å¿†æ•°æ®
â””â”€â”€ README.md                 # æœ¬æ–‡æ¡£
```

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. å­¦ä¹ è®°å¿†ç³»ç»Ÿ

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… JSONæ–‡ä»¶æŒä¹…åŒ–å­˜å‚¨
- âœ… è‡ªåŠ¨åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®ï¼ˆ20æ¡ï¼‰
- âœ… æ”¯æŒæŒ‰æ ‡ç­¾å’Œéš¾åº¦ç­›é€‰
- âœ… è‡ªåŠ¨ç»Ÿè®¡è–„å¼±çŸ¥è¯†ç‚¹ï¼ˆæˆåŠŸç‡<60%ï¼‰
- âœ… è‡ªåŠ¨ç»Ÿè®¡å·²æŒæ¡çŸ¥è¯†ç‚¹ï¼ˆæˆåŠŸç‡â‰¥80%ï¼‰
- âœ… è§£é¢˜æˆåŠŸåè‡ªåŠ¨ä¿å­˜è®°å½•

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from memory_storage import memory_storage

# æ·»åŠ è®°å½•
record_id = memory_storage.add_record({
    "question": "é¢˜ç›®",
    "answer": "ç­”æ¡ˆ",
    "tags": ["å‡½æ•°"],
    "difficulty": "ä¸­ç­‰",
    "success": True,
    "steps": 5,
    "time_used": "30ç§’"
})

# æŸ¥è¯¢è®°å½•
records = memory_storage.get_records(tag="å‡½æ•°", difficulty="ä¸­ç­‰")

# è·å–ç»Ÿè®¡
stats = memory_storage.get_statistics()
```

---

### 2. ç»Ÿè®¡æ•°æ®è®¡ç®—

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ¯å‘¨æ´»åŠ¨è¶‹åŠ¿ï¼ˆè§£é¢˜æ•°ã€ç”Ÿæˆæ•°ï¼‰
- âœ… çŸ¥è¯†ç‚¹åˆ†å¸ƒï¼ˆé¥¼å›¾æ•°æ®ï¼‰
- âœ… éš¾åº¦åˆ†å¸ƒï¼ˆé¥¼å›¾æ•°æ®ï¼‰
- âœ… æˆåŠŸç‡è¶‹åŠ¿ï¼ˆæŠ˜çº¿å›¾æ•°æ®ï¼‰
- âœ… ç»¼åˆç»Ÿè®¡ï¼ˆæˆåŠŸç‡ã€æœ¬å‘¨è§£é¢˜æ•°ã€æŒæ¡çŸ¥è¯†ç‚¹æ•°ã€è¿ç»­å¤©æ•°ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from statistics_calculator import statistics_calculator

# è·å–æ‰€æœ‰ç»Ÿè®¡æ•°æ®
all_stats = statistics_calculator.get_all_statistics()

# è·å–å•é¡¹æ•°æ®
weekly_data = statistics_calculator.get_weekly_data()
knowledge_data = statistics_calculator.get_knowledge_data()
```

---

### 3. æ¯æ—¥ä¸€é¢˜æ¨è

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… 7é“é«˜è´¨é‡é¢˜ç›®æ± 
- âœ… 3ç§æ¨èç­–ç•¥ï¼ˆbalanced/weak/randomï¼‰
- âœ… åŸºäºè–„å¼±çŸ¥è¯†ç‚¹çš„æ™ºèƒ½æ¨è
- âœ… å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼ˆé¢˜ç›®ã€ç­”æ¡ˆã€æç¤ºï¼‰
- âœ… å­¦ä¹ ç»Ÿè®¡ï¼ˆè¿ç»­å¤©æ•°ã€å®Œæˆæ•°ã€æˆåŠŸç‡ï¼‰
- âœ… 7å¤©å†å²è®°å½•

**é¢˜ç›®æ± å†…å®¹**:
1. å‡½æ•°ä¸å¯¼æ•°ç»¼åˆé¢˜ï¼ˆå›°éš¾ï¼‰
2. æ•°åˆ—é€’æ¨ä¸æ±‚å’Œï¼ˆä¸­ç­‰ï¼‰
3. ä¸‰è§’å‡½æ•°ä¸è§£ä¸‰è§’å½¢ï¼ˆä¸­ç­‰ï¼‰
4. æ¤­åœ†ä¸ç›´çº¿ç»¼åˆï¼ˆå›°éš¾ï¼‰
5. å‡½æ•°æå€¼ä¸æ–¹ç¨‹ï¼ˆä¸­ç­‰ï¼‰
6. ç«‹ä½“å‡ ä½•ä¸ç©ºé—´å‘é‡ï¼ˆå›°éš¾ï¼‰
7. ç­‰å·®æ•°åˆ—ä¸è£‚é¡¹æ±‚å’Œï¼ˆä¸­ç­‰ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from daily_recommender import daily_recommender

# è·å–æ¯æ—¥ä¸€é¢˜ï¼ˆå¹³è¡¡æ¨¡å¼ï¼‰
question = daily_recommender.get_daily_question(strategy="balanced")

# è·å–æ¯æ—¥ä¸€é¢˜ï¼ˆè–„å¼±çŸ¥è¯†ç‚¹æ¨¡å¼ï¼‰
question = daily_recommender.get_daily_question(strategy="weak")
```

---

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…åŒ–**: å­¦ä¹ è®°å½•ä¿å­˜åœ¨ `data/memory_records.json`ï¼Œè¯·å‹¿åˆ é™¤
2. **API Keyå®‰å…¨**: ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
3. **CORSé…ç½®**: å·²é…ç½®å…è®¸å‰ç«¯è·¨åŸŸè®¿é—®
4. **ä»£ç æ‰§è¡Œå®‰å…¨**: Pythonæ‰§è¡Œå™¨æœ‰å®‰å…¨é™åˆ¶ï¼Œç¦æ­¢å±é™©æ“ä½œ
5. **è¶…æ—¶è®¾ç½®**: LLMè°ƒç”¨é»˜è®¤è¶…æ—¶60ç§’
6. **é”™è¯¯å¤„ç†**: æ‰€æœ‰APIéƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

## å¼€å‘å»ºè®®

- ä½¿ç”¨ `uvicorn app:app --reload` å¯åŠ¨å¼€å‘æ¨¡å¼
- æŸ¥çœ‹ `/docs` ç«¯ç‚¹æµ‹è¯•API
- æŸ¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜
- æ ¹æ®éœ€è¦è°ƒæ•´ `config.py` ä¸­çš„é…ç½®
- å®šæœŸå¤‡ä»½ `data/memory_records.json` æ–‡ä»¶

---

## ä¸å‰ç«¯çš„å®Œæ•´å¯¹æ¥

### å‰ç«¯é¡µé¢ â†’ åç«¯æ¥å£æ˜ å°„

| å‰ç«¯é¡µé¢ | åç«¯æ¥å£ | æ•°æ®çŠ¶æ€ |
|---------|---------|---------|
| SolveProblem | POST /solve | âœ… çœŸå®æ•°æ® + è‡ªåŠ¨ä¿å­˜ |
| GenerateQuestion | POST /generate | âœ… çœŸå®æ•°æ® |
| LearningMemory | GET /memory | âœ… çœŸå®æ•°æ®ï¼ˆ20æ¡ç¤ºä¾‹ï¼‰ |
| Statistics | GET /statistics | âœ… çœŸå®æ•°æ®ï¼ˆåŸºäºè®°å¿†è®¡ç®—ï¼‰ |
| DailyQuestion | GET /daily | âœ… çœŸå®æ•°æ®ï¼ˆæ™ºèƒ½æ¨èï¼‰ |
| DailyQuestion | POST /daily/submit | âœ… æ­£å¸¸å·¥ä½œ |
| GeometryPlot | POST /plot/execute | âœ… çœŸå®æ•°æ® |
| GeometryPlot | POST /plot/generate | âœ… çœŸå®æ•°æ® |

---

## æ›´æ–°æ—¥å¿—

### v1.1.0 (2025-01-20)

**æ–°å¢åŠŸèƒ½**:
- âœ¨ å­¦ä¹ è®°å¿†å­˜å‚¨ç³»ç»Ÿï¼ˆmemory_storage.pyï¼‰
- âœ¨ ç»Ÿè®¡æ•°æ®è®¡ç®—æ¨¡å—ï¼ˆstatistics_calculator.pyï¼‰
- âœ¨ æ¯æ—¥ä¸€é¢˜æ¨èç³»ç»Ÿï¼ˆdaily_recommender.pyï¼‰
- âœ¨ 20æ¡ç¤ºä¾‹å­¦ä¹ è®°å½•
- âœ¨ 7é“é«˜è´¨é‡é¢˜ç›®æ± 
- âœ¨ è§£é¢˜æˆåŠŸè‡ªåŠ¨ä¿å­˜è®°å½•

**æ”¹è¿›åŠŸèƒ½**:
- ğŸ”§ /statistics æ¥å£è¿”å›çœŸå®ç»Ÿè®¡æ•°æ®
- ğŸ”§ /memory æ¥å£è¿”å›çœŸå®å­¦ä¹ è®°å½•
- ğŸ”§ /daily æ¥å£å®ç°æ™ºèƒ½æ¨èç®—æ³•
- ğŸ”§ /solve æ¥å£è‡ªåŠ¨ä¿å­˜è§£é¢˜è®°å½•

**ä¿®å¤é—®é¢˜**:
- ğŸ› ä¿®å¤ /daily/submit æ¥å£å‚æ•°é—®é¢˜

---

## æŠ€æœ¯æ ˆ

- **FastAPI**: ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- **Pydantic**: æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†
- **OpenAI SDK**: LLMè°ƒç”¨
- **Matplotlib**: å›¾å½¢ç»˜åˆ¶
- **JSON**: æ•°æ®æŒä¹…åŒ–

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
